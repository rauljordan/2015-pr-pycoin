{% extends "layout.html" %}

{% block content %}
  <img src="{{url_for('static', filename='img/714.GIF')}}" style="width:200px;height:200;" class="loader centered">

  <div class="row">
    <div id="node-container" class="col s6" style="margin-top:50px;overflow:hiddden" >

    </div>
    <div class="col s6" style="margin-top:50px;">

      <div class="row" style="z-index:100;position:relative;" id="image-container">

        <div class="col s3">
          <div class="card" style="padding-bottom:30px;height: 255px">
            <div class="card-image waves-effect waves-block waves-light">
              <img id="first-image" src="{{url_for('static', filename='img/coins/BTC.png')}}" alt="img/coins/COIN.png">
            </div>
            <div class="card-content">
              <span class="card-title activator grey-text text-darken-4" id="first-name">BTC </span>
            </div>
           
          </div>
        </div>  

        <div class="col s3">
          <div class="card" style="padding-bottom:30px; height: 255px" >
            <div class="card-image waves-effect waves-block waves-light">
              <img id="second-image" src="{{url_for('static', filename='img/coins/LTC.png')}}" alt="img/coins/COIN.png">
            </div>
            <div class="card-content">
              <span class="card-title activator grey-text text-darken-4" id="second-name">LTC </span>
            </div>
            
          </div>
        </div>

        <div class="col s6">
          <div class="card amber accent-4" style="padding-bottom:4px;overflow:scroll;overflow-x:hidden;height: 255px">
            <div class="card-content white-text">
              <span class="card-title" style = "font-size:20px"><strog>Recent Trade Information*</strong></span>
              <p><strong>Average Trading Price: </strong></p>
              <p id="average-price" style="font-size:18px;width:80%;"></p>
              <br>
              <p><strong>Total Trading Volume: </strong></p>
              <p id="total-volume" style="font-size:18px;width:80%;"></p>
              <br>
              <p><strong style="font-size:10px;width:80%;">*based off of the past 200 trades </strong></p>
              <p id="footer" style="font-size:30px;width:80%;"></p>
            </div>
            
          </div>
        </div>


      </div>

     
      <div class="row" id="search-container">
        <div class="input-field col s12">
          <select style="position:relative;z-index:10000;" id="first-select">

          </select>
          <label>Select Cryptocurrency</label>
        </div>
      </div>


      <div class="row">
          <div id="barchart-container" class="col s12">

          </div>
          <div id="barchart-container2" class="col s12">

          </div>
      </div>

    </div>
  </div>
        
  <script type="text/javascript">
    $(document).ready(function() {
      $('.page-footer').hide();


      var introguide = introJs();
      introguide.setOptions({'tooltipPosition': 'auto', 'showProgress': 'true', 'showStepNumbers': 'false', 
       'showBullets': 'true', "showButtons": "false"});
      introguide.setOptions({
        steps: [
        {
          intro: 'Pycoin is a way to see how the world\'s cryptocurrencies interact with each other',
          position: 'center'
        },
        {
          element: '#image-container',
          intro: 'These are the icons of currently selected cryptocurrencies as well as recent trade information',
          position: 'bottom'
        },
        {
          element: '#search-container',
          intro: 'Use this drop-down menu to individually select the currency you are looking for',
          position: 'top'
        },
        {
          element: '#node-container',
          intro: 'This graph visualization shows how the world\'s cryptocurrencies trade with each other',
          position: 'top'
        },
        {
          element: '#node-container',
          intro: 'Each currency is a node. When they are traded with each other, an edge is drawn between them.',
          position: 'top'
        },
        {
          element: '#node-container',
          intro: 'Click and drag a currency to pin it down. Hover over the currency to see more information',
          position: 'top'
        },
        {
          element: '#node-container',
          intro: 'Hover over the edge between two currencies to see more information about how they are traded.',
          position: 'bottom'
        },
        {
          element: '#node-container',
          intro: 'Double-click a currency to highlight the currency and all the currencies being traded with it.',
          position: 'bottom'
        },
        {
          element: '#node-container',
          intro: 'Double-click again to return to the original view',
          position: 'bottom'
        },
        {
          element: '#barchart-container',
          intro: 'This graph shows trade volume between selected currencies',
          position: 'left'
        },
        {
          element: '#barchart-container2',
          intro: 'This graph shows price fluctuations between selected currencies',
          position: 'top'
        },
        ]
      });

      var nodeData = [];
      var marketData = [];

      var initVis = function() {
        introguide.start();

        var MyEventHandler = {};
        var force = new Force(d3.select("#node-container"), nodeData, MyEventHandler);
        var volume = new Volume(d3.select("#barchart-container"), marketData, MyEventHandler);
        var price = new Cex(d3.select("#barchart-container2"), marketData, MyEventHandler);

        $(MyEventHandler).bind("selectionChanged", function(event, names){
            volume.onSelectionChange(names);
            price.onSelectionChange(names);
        });

        var coinNames = Object.keys(nodeData).sort();
        for (var coin in coinNames) {
            
            
              $('#first-select')
                  .append($("<option></option>")
                  .attr("value",coinNames[coin])
                  .text(coinNames[coin])); 
 
        }

        $('select').material_select();

      };

      var dataLoaded = function(error, _nodeData, _marketData) {
        if (!error) {
          $('.loader').hide();
          $('.page-footer').show();

          nodeData = _nodeData;
          marketData = _marketData;

          initVis();
        }
      };

      var startHere = function(){
        queue()
        .defer(d3.json, "{{url_for('static', filename='data/nodes.json')}}")
        .defer(d3.json, "{{url_for('static', filename='data/markets.json')}}")
        .await(dataLoaded); 
      }

      startHere();

    });
  </script>

{% endblock %}
